<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë‡Œ ì‹ ê²½í™”í•™ ì‹œë®¬ë ˆì´ì…˜</title>
<style>
  body { background:#0a0a0a; color:#eee; font-family:'Segoe UI',sans-serif; margin:0; padding:20px; }
  .container { max-width:1600px; margin:0 auto; }
  h2 { text-align:center; color:#4fc3f7; margin-bottom:5px; }
  .subtitle { text-align:center; color:#888; font-size:13px; margin-bottom:20px; }
  .main-grid { display:grid; grid-template-columns:1fr 1200px 1fr; gap:15px; }
  canvas { background:#000; display:block; border:2px solid #333; border-radius:8px; }
  #controls { background:#1a1a1a; padding:15px; border-radius:8px; }
  .control-group { margin-bottom:12px; }
  label { display:block; color:#aaa; font-size:12px; margin-bottom:3px; }
  input[type="number"], select { width:100%; padding:6px; background:#2a2a2a; border:1px solid #444; color:#fff; border-radius:4px; font-size:12px; }
  button { width:100%; padding:8px; margin:3px 0; background:#4fc3f7; color:#000; border:none; border-radius:4px; cursor:pointer; font-weight:bold; font-size:12px; }
  button:hover { background:#81d4fa; }
  #rightPanel { background:#1a1a1a; padding:15px; border-radius:8px; max-height:800px; overflow-y:auto; }
  .info-section { background:#2a2a2a; padding:12px; margin:8px 0; border-radius:6px; border-left:3px solid #4fc3f7; font-size:11px; line-height:1.5; }
  .info-title { color:#4fc3f7; font-weight:bold; margin-bottom:5px; font-size:12px; }
  .equation { background:#1a1a1a; padding:8px; margin:5px 0; border-radius:4px; font-family:monospace; font-size:11px; color:#ffaa00; }
  .value-display { color:#ff4444; font-weight:bold; }
  #legend { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; font-size:11px; padding:10px; background:#1a1a1a; border-radius:6px; margin-top:10px; }
  .legend-item { display:flex; align-items:center; gap:5px; }
  .legend-color { width:15px; height:15px; border-radius:2px; }
  .neurotransmitter-bar { height:8px; background:#333; border-radius:4px; margin:5px 0; overflow:hidden; }
  .nt-fill { height:100%; transition:width 0.3s; }
  ::-webkit-scrollbar { width:8px; }
  ::-webkit-scrollbar-track { background:#1a1a1a; }
  ::-webkit-scrollbar-thumb { background:#4fc3f7; border-radius:4px; }
</style>
</head>
<body>
<div class="container">
  <h2>ğŸ§¬ ë‡Œ ì‹ ê²½í™”í•™ ì‹œë®¬ë ˆì´ì…˜ - ìƒë¬¼ë¬¼ë¦¬í•™ ëª¨ë¸</h2>
  <div class="subtitle">DNA Helix â€¢ Navier-Stokes 2D â€¢ Burgers Equation â€¢ Quantum Tunneling â€¢ Acid-Base Chemistry</div>
  
  <div class="main-grid">
    <!-- ì™¼ìª½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
    <div id="controls">
      <div class="control-group">
        <label>ğŸ’Š í–¥ì •ì‹ ì„± ë¬¼ì§ˆ</label>
        <select id="drugSelect">
          <option value="none">ì—†ìŒ (ì •ìƒ)</option>
          <option value="caffeine">ì¹´í˜ì¸</option>
          <option value="nicotine">ë‹ˆì½”í‹´</option>
          <option value="alcohol">ì•Œì½”ì˜¬</option>
          <option value="thc">THC</option>
          <option value="mdma">MDMA</option>
          <option value="cocaine">ì½”ì¹´ì¸</option>
          <option value="amphetamine">ì•”í˜íƒ€ë¯¼</option>
          <option value="lsd">LSD</option>
          <option value="psilocybin">ì‹¤ë¡œì‹œë¹ˆ</option>
          <option value="ketamine">ì¼€íƒ€ë¯¼</option>
        </select>
      </div>
      
      <div class="control-group">
        <label>âš—ï¸ íˆ¬ì—¬ëŸ‰ (mg)</label>
        <input id="dosage" type="number" value="100" min="0" step="10">
      </div>
      
      <div class="control-group">
        <label>â±ï¸ ê²½ê³¼ ì‹œê°„ (ë¶„)</label>
        <input id="timeElapsed" type="number" value="30" min="0" step="5">
      </div>
      
      <div class="control-group">
        <label>ğŸ§¬ DNA ë‚˜ì„  ë°€ë„</label>
        <input id="helixDensity" type="number" value="0.7" min="0.1" max="1" step="0.1">
      </div>
      
      <div class="control-group">
        <label>ğŸŒŠ ìœ ì²´ ì ì„± (Î¼)</label>
        <input id="viscosity" type="number" value="0.05" min="0.01" max="0.2" step="0.01">
      </div>
      
      <div class="control-group">
        <label>âš¡ í™•ì‚° ê³„ìˆ˜ (D)</label>
        <input id="diffusion" type="number" value="1.5" min="0.5" max="5" step="0.5">
      </div>
      
      <div class="control-group">
        <label>ğŸ¯ ì–‘ì í„°ë„ë§ í™•ë¥ </label>
        <input id="tunneling" type="number" value="0.08" min="0" max="0.3" step="0.01">
      </div>
      
      <div class="control-group">
        <label>ğŸ§ª pH ë ˆë²¨</label>
        <input id="pH" type="number" value="7.4" min="6.8" max="7.8" step="0.1">
      </div>
      
      <button id="applyBtn">ğŸš€ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘</button>
      <button id="pauseBtn">â¸ï¸ ì¼ì‹œì •ì§€</button>
      <button id="resetBtn">ğŸ”„ ì´ˆê¸°í™”</button>
      <button id="saveBtn">ğŸ’¾ ì´ë¯¸ì§€ ì €ì¥</button>
    </div>
    
    <!-- ì¤‘ì•™ ìº”ë²„ìŠ¤ -->
    <div>
      <canvas id="canvas" width="1200" height="800"></canvas>
      <div id="legend">
        <div class="legend-item"><div class="legend-color" style="background:#ff4444;"></div>í™œì„± ì˜ì—­</div>
        <div class="legend-item"><div class="legend-color" style="background:#444;"></div>ë¹„í™œì„±</div>
        <div class="legend-item"><div class="legend-color" style="background:#ffaa00;"></div>ì‹ ê²½ì „ë‹¬ë¬¼ì§ˆ</div>
        <div class="legend-item"><div class="legend-color" style="background:#4fc3f7;"></div>ì‹œëƒ…ìŠ¤</div>
        <div class="legend-item"><div class="legend-color" style="background:#0f0;"></div>ì „ì êµ¬ë¦„</div>
        <div class="legend-item"><div class="legend-color" style="background:red;"></div>DNA A</div>
        <div class="legend-item"><div class="legend-color" style="background:green;"></div>DNA T</div>
        <div class="legend-item"><div class="legend-color" style="background:blue;"></div>DNA C</div>
        <div class="legend-item"><div class="legend-color" style="background:yellow;"></div>DNA G</div>
      </div>
    </div>
    
    <!-- ì˜¤ë¥¸ìª½ ì •ë³´ íŒ¨ë„ -->
    <div id="rightPanel"></div>
  </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let isPaused = false;

// ë¬¼ë¦¬ ìƒìˆ˜
const BOLTZMANN = 1.380649e-23;
const PLANCK = 6.62607015e-34;
const AVOGADRO = 6.02214076e23;

// ë‡Œ ì˜ì—­ ì •ì˜
const brainRegions = {
  prefrontalCortex: { x: 600, y: 200, name: 'ì „ì „ë‘í”¼ì§ˆ', size: 40, dna: 'ATCGATCGATCG' },
  motorCortex: { x: 500, y: 180, name: 'ìš´ë™í”¼ì§ˆ', size: 35, dna: 'GCTAGCTAGCTA' },
  premotor: { x: 550, y: 170, name: 'ì „ìš´ë™í”¼ì§ˆ', size: 30, dna: 'CGCGATATCGCG' },
  parietalCortex: { x: 400, y: 200, name: 'ë‘ì •ì—½', size: 35, dna: 'TATACGCGTATA' },
  somatosensory: { x: 450, y: 220, name: 'ì²´ê°ê°', size: 30, dna: 'GCGCATATATAT' },
  temporalCortex: { x: 650, y: 350, name: 'ì¸¡ë‘ì—½', size: 35, dna: 'ATATATCGCGCG' },
  auditoryCortex: { x: 550, y: 330, name: 'ì²­ê°í”¼ì§ˆ', size: 30, dna: 'CGCGCGATATAT' },
  hippocampus: { x: 600, y: 400, name: 'í•´ë§ˆ', size: 28, dna: 'ATCGATCGATCG' },
  amygdala: { x: 650, y: 420, name: 'í¸ë„ì²´', size: 25, dna: 'GCTAGCTAGCTA' },
  occipitalCortex: { x: 300, y: 250, name: 'í›„ë‘ì—½', size: 35, dna: 'TATATACGCGCG' },
  visualCortex: { x: 350, y: 280, name: 'ì‹œê°í”¼ì§ˆ', size: 32, dna: 'CGCGATATATCG' },
  cingulate: { x: 550, y: 280, name: 'ëŒ€ìƒíšŒ', size: 30, dna: 'ATCGCGCGATCG' },
  insula: { x: 700, y: 300, name: 'ì„¬ì—½', size: 28, dna: 'GCGCATATGCGC' },
  striatum: { x: 600, y: 320, name: 'ì„ ì¡°ì²´', size: 30, dna: 'ATATCGCGATAT' },
  nucleusAccumbens: { x: 620, y: 340, name: 'ì¸¡ì¢Œí•µ', size: 25, dna: 'CGCGATCGCGAT' },
  substantiaNigra: { x: 580, y: 450, name: 'í‘ì§ˆ', size: 26, dna: 'ATCGATATATCG' },
  hypothalamus: { x: 600, y: 480, name: 'ì‹œìƒí•˜ë¶€', size: 24, dna: 'GCGCGCATATAT' },
  thalamus: { x: 550, y: 360, name: 'ì‹œìƒ', size: 28, dna: 'TATACGCGATAT' },
  brainstem: { x: 600, y: 550, name: 'ë‡Œê°„', size: 30, dna: 'ATCGCGCGCGAT' },
  cerebellum: { x: 450, y: 600, name: 'ì†Œë‡Œ', size: 40, dna: 'GCGCATATCGCG' },
  vta: { x: 560, y: 500, name: 'VTA', size: 22, dna: 'ATATATCGCGCG' },
  raphe: { x: 620, y: 520, name: 'ë´‰ì„ í•µ', size: 22, dna: 'CGCGCGATATAT' },
  locusCoeruleus: { x: 540, y: 540, name: 'ì²­ë°˜', size: 20, dna: 'ATATCGCGATCG' }
};

// í–¥ì •ì‹ ì„± ë¬¼ì§ˆ ë°ì´í„°
const drugData = {
  none: {
    name: 'ì •ìƒ ìƒíƒœ',
    activeRegions: ['prefrontalCortex', 'motorCortex', 'visualCortex', 'auditoryCortex', 'thalamus'],
    effectStrength: 0.3,
    dopamine: 0.5, serotonin: 0.5, gaba: 0.5, glutamate: 0.5, acetylcholine: 0.5,
    pH_shift: 0, osmolarity: 1.0, temperature: 310.15
  },
  caffeine: {
    name: 'ì¹´í˜ì¸',
    activeRegions: ['prefrontalCortex', 'motorCortex', 'premotor', 'parietalCortex', 'cingulate', 'thalamus', 'brainstem', 'locusCoeruleus'],
    effectStrength: 0.5,
    dopamine: 0.7, serotonin: 0.5, gaba: 0.4, glutamate: 0.6, acetylcholine: 0.6,
    pH_shift: 0.1, osmolarity: 1.05, temperature: 310.5
  },
  nicotine: {
    name: 'ë‹ˆì½”í‹´',
    activeRegions: ['prefrontalCortex', 'striatum', 'nucleusAccumbens', 'vta', 'hippocampus', 'amygdala', 'insula', 'thalamus'],
    effectStrength: 0.6,
    dopamine: 0.85, serotonin: 0.6, gaba: 0.5, glutamate: 0.7, acetylcholine: 0.9,
    pH_shift: -0.05, osmolarity: 1.02, temperature: 310.3
  },
  alcohol: {
    name: 'ì•Œì½”ì˜¬',
    activeRegions: ['prefrontalCortex', 'hippocampus', 'amygdala', 'cerebellum', 'brainstem', 'striatum'],
    inactiveRegions: ['motorCortex', 'premotor', 'somatosensory', 'visualCortex'],
    effectStrength: 0.7,
    dopamine: 0.6, serotonin: 0.55, gaba: 0.9, glutamate: 0.3, acetylcholine: 0.4,
    pH_shift: -0.15, osmolarity: 0.95, temperature: 309.8
  },
  thc: {
    name: 'THC',
    activeRegions: ['prefrontalCortex', 'hippocampus', 'amygdala', 'striatum', 'nucleusAccumbens', 'cerebellum', 'hypothalamus', 'vta'],
    effectStrength: 0.75,
    dopamine: 0.75, serotonin: 0.6, gaba: 0.7, glutamate: 0.65, acetylcholine: 0.55,
    pH_shift: 0.05, osmolarity: 1.08, temperature: 310.4
  },
  mdma: {
    name: 'MDMA',
    activeRegions: ['prefrontalCortex', 'amygdala', 'hippocampus', 'striatum', 'nucleusAccumbens', 'vta', 'raphe', 'insula', 'cingulate'],
    effectStrength: 0.9,
    dopamine: 0.8, serotonin: 0.95, gaba: 0.6, glutamate: 0.7, acetylcholine: 0.65,
    pH_shift: 0.2, osmolarity: 1.15, temperature: 311.5
  },
  cocaine: {
    name: 'ì½”ì¹´ì¸',
    activeRegions: ['prefrontalCortex', 'striatum', 'nucleusAccumbens', 'vta', 'motorCortex', 'amygdala', 'cingulate', 'insula', 'locusCoeruleus'],
    effectStrength: 0.95,
    dopamine: 0.98, serotonin: 0.7, gaba: 0.5, glutamate: 0.8, acetylcholine: 0.65,
    pH_shift: 0.15, osmolarity: 1.2, temperature: 311.2
  },
  amphetamine: {
    name: 'ì•”í˜íƒ€ë¯¼',
    activeRegions: ['prefrontalCortex', 'striatum', 'nucleusAccumbens', 'vta', 'motorCortex', 'premotor', 'parietalCortex', 'cingulate', 'locusCoeruleus'],
    effectStrength: 0.85,
    dopamine: 0.95, serotonin: 0.65, gaba: 0.45, glutamate: 0.75, acetylcholine: 0.7,
    pH_shift: 0.18, osmolarity: 1.18, temperature: 311.0
  },
  lsd: {
    name: 'LSD',
    activeRegions: ['prefrontalCortex', 'visualCortex', 'occipitalCortex', 'temporalCortex', 'parietalCortex', 'cingulate', 'insula', 'thalamus', 'raphe', 'hippocampus'],
    effectStrength: 0.95,
    dopamine: 0.7, serotonin: 0.98, gaba: 0.6, glutamate: 0.85, acetylcholine: 0.75,
    pH_shift: 0.12, osmolarity: 1.12, temperature: 310.8
  },
  psilocybin: {
    name: 'ì‹¤ë¡œì‹œë¹ˆ',
    activeRegions: ['prefrontalCortex', 'visualCortex', 'occipitalCortex', 'cingulate', 'hippocampus', 'amygdala', 'thalamus', 'raphe', 'insula'],
    effectStrength: 0.9,
    dopamine: 0.65, serotonin: 0.95, gaba: 0.55, glutamate: 0.8, acetylcholine: 0.7,
    pH_shift: 0.1, osmolarity: 1.1, temperature: 310.6
  },
  ketamine: {
    name: 'ì¼€íƒ€ë¯¼',
    activeRegions: ['prefrontalCortex', 'hippocampus', 'thalamus', 'cingulate'],
    inactiveRegions: ['motorCortex', 'cerebellum', 'somatosensory', 'visualCortex', 'auditoryCortex'],
    effectStrength: 0.85,
    dopamine: 0.7, serotonin: 0.6, gaba: 0.65, glutamate: 0.25, acetylcholine: 0.5,
    pH_shift: -0.1, osmolarity: 0.92, temperature: 309.9
  }
};

let currentDrug = 'none';
let animationFrame;
let time = 0;
let particles = [];
let electrons = [];
let fluidField = [];

// DNA ì´ì¤‘ë‚˜ì„  ìƒì„±
function generateDNAHelix(sequence, x0, y0, radius) {
  const helix = [];
  const baseColors = { A: '#ff0000', T: '#00ff00', C: '#0000ff', G: '#ffff00' };
  const pairs = { A: 'T', T: 'A', C: 'G', G: 'C' };
  
  for (let i = 0; i < sequence.length; i++) {
    const t = i * 0.5;
    const angle = t;
    const x1 = x0 + radius * Math.cos(angle);
    const y1 = y0 + radius * Math.sin(angle) + i * 2;
    const x2 = x0 - radius * Math.cos(angle);
    const y2 = y0 - radius * Math.sin(angle) + i * 2;
    
    helix.push({
      x1, y1, x2, y2,
      base1: sequence[i],
      base2: pairs[sequence[i]],
      color1: baseColors[sequence[i]],
      color2: baseColors[pairs[sequence[i]]]
    });
  }
  return helix;
}

// Navier-Stokes 2D ìœ ì²´ í•„ë“œ (ê°„ì†Œí™”)
function initFluidField() {
  fluidField = [];
  for (let i = 0; i < 50; i++) {
    for (let j = 0; j < 50; j++) {
      fluidField.push({
        x: i * 24,
        y: j * 16,
        vx: (Math.random() - 0.5) * 0.5,
        vy: (Math.random() - 0.5) * 0.5,
        pressure: 1.0
      });
    }
  }
}

// Burgers ë°©ì •ì‹ ì ìš© (ë¹„ì„ í˜• ëŒ€ë¥˜)
function applyBurgersEquation(drug) {
  const viscosity = parseFloat(document.getElementById('viscosity').value);
  const dt = 0.1;
  
  fluidField.forEach((cell, idx) => {
    // âˆ‚u/âˆ‚t + uâˆ‚u/âˆ‚x = Î½âˆ‚Â²u/âˆ‚xÂ²
    const advection = cell.vx * cell.vx * 0.1;
    const diffusion = viscosity * (Math.random() - 0.5);
    
    cell.vx += (-advection + diffusion) * dt * drug.effectStrength;
    cell.vy += (-advection + diffusion) * dt * drug.effectStrength;
    
    // ì†ë„ ì œí•œ
    const speed = Math.sqrt(cell.vx * cell.vx + cell.vy * cell.vy);
    if (speed > 2) {
      cell.vx = (cell.vx / speed) * 2;
      cell.vy = (cell.vy / speed) * 2;
    }
  });
}

// ì „ì êµ¬ë¦„ ìƒì„± (ì–‘ìì—­í•™ì )
function createElectronCloud(region, count) {
  const newElectrons = [];
  const diffusion = parseFloat(document.getElementById('diffusion').value);
  
  for (let i = 0; i < count; i++) {
    // Gaussian ë¶„í¬
    const r = diffusion * Math.sqrt(-2 * Math.log(Math.random()));
    const theta = 2 * Math.PI * Math.random();
    
    newElectrons.push({
      x: region.x + r * Math.cos(theta),
      y: region.y + r * Math.sin(theta),
      vx: (Math.random() - 0.5) * 0.5,
      vy: (Math.random() - 0.5) * 0.5,
      energy: Math.random() * 2,
      phase: Math.random() * Math.PI * 2
    });
  }
  return newElectrons;
}

// ì–‘ì í„°ë„ë§
function quantumTunneling(electron) {
  const tunnelingProb = parseFloat(document.getElementById('tunneling').value);
  
  if (Math.random() < tunnelingProb) {
    // ì¥ë²½ í†µê³¼ - í° ê±°ë¦¬ ìˆœê°„ì´ë™
    const tunnelingDistance = 50 + Math.random() * 100;
    const angle = Math.random() * Math.PI * 2;
    electron.x += tunnelingDistance * Math.cos(angle);
    electron.y += tunnelingDistance * Math.sin(angle);
    return true;
  }
  return false;
}

// ì‚°-ì—¼ê¸° í‰í˜• ê³„ì‚°
function calculateAcidBase() {
  const pH = parseFloat(document.getElementById('pH').value);
  const drug = drugData[currentDrug];
  const effectivePH = pH + drug.pH_shift;
  
  // Henderson-Hasselbalch equation
  // pH = pKa + log([A-]/[HA])
  const pKa = 7.4; // ìƒë¦¬í•™ì  pKa
  const ratio = Math.pow(10, effectivePH - pKa);
  
  return {
    pH: effectivePH,
    acidicForm: 1 / (1 + ratio),
    basicForm: ratio / (1 + ratio),
    bufferCapacity: 2.303 * ratio / Math.pow(1 + ratio, 2)
  };
}

// ì…ì ìƒì„±
function createParticles(activeRegions, drug) {
  particles = [];
  const particleCount = Math.floor(drug.effectStrength * 60);
  
  activeRegions.forEach(regionKey => {
    const region = brainRegions[regionKey];
    if (!region) return;
    
    const count = Math.floor(particleCount / activeRegions.length);
    for (let i = 0; i < count; i++) {
      particles.push({
        x: region.x + (Math.random() - 0.5) * region.size,
        y: region.y + (Math.random() - 0.5) * region.size,
        vx: (Math.random() - 0.5) * 3,
        vy: (Math.random() - 0.5) * 3,
        life: 1,
        type: ['dopamine', 'serotonin', 'gaba', 'glutamate'][Math.floor(Math.random() * 4)]
      });
    }
  });
}

// ë‡Œ ì™¸ê³½ì„ 
function drawBrainOutline() {
  ctx.strokeStyle = '#333';
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.ellipse(500, 350, 250, 280, 0, 0, Math.PI * 2);
  ctx.moveTo(350, 600);
  ctx.quadraticCurveTo(450, 650, 550, 600);
  ctx.moveTo(580, 550);
  ctx.lineTo(600, 650);
  ctx.stroke();
  
  ctx.strokeStyle = '#222';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(500, 100);
  ctx.lineTo(500, 550);
  ctx.stroke();
}

// ë Œë”ë§
function render() {
  if (isPaused) return;
  
  ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  drawBrainOutline();
  
  const drug = drugData[currentDrug];
  const activeRegions = drug.activeRegions || [];
  const inactiveRegions = drug.inactiveRegions || [];
  const helixDensity = parseFloat(document.getElementById('helixDensity').value);
  
  time += 0.1;
  
  // Burgers ë°©ì •ì‹ ì ìš©
  applyBurgersEquation(drug);
  
  // ìœ ì²´ í•„ë“œ ì‹œê°í™” (ì•½í•˜ê²Œ)
  ctx.globalAlpha = 0.1;
  fluidField.forEach(cell => {
    const speed = Math.sqrt(cell.vx * cell.vx + cell.vy * cell.vy);
    ctx.strokeStyle = `rgba(79, 195, 247, ${speed * 0.5})`;
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(cell.x, cell.y);
    ctx.lineTo(cell.x + cell.vx * 10, cell.y + cell.vy * 10);
    ctx.stroke();
  });
  ctx.globalAlpha = 1;
  
  // ì‹œëƒ…ìŠ¤ ì—°ê²°
  activeRegions.forEach(key1 => {
    const region1 = brainRegions[key1];
    if (!region1) return;
    
    activeRegions.forEach(key2 => {
      if (key1 >= key2) return;
      const region2 = brainRegions[key2];
      if (!region2 || Math.random() > helixDensity) return;
      
      const gradient = ctx.createLinearGradient(region1.x, region1.y, region2.x, region2.y);
      gradient.addColorStop(0, 'rgba(79, 195, 247, 0.4)');
      gradient.addColorStop(1, 'rgba(79, 195, 247, 0.1)');
      
      ctx.strokeStyle = gradient;
      ctx.lineWidth = 1 + drug.effectStrength * 2;
      ctx.beginPath();
      ctx.moveTo(region1.x, region1.y);
      ctx.lineTo(region2.x, region2.y);
      ctx.stroke();
    });
  });
  
  // ì „ì êµ¬ë¦„ ì—…ë°ì´íŠ¸
  electrons.forEach((e, idx) => {
    e.x += e.vx;
    e.y += e.vy;
    e.phase += 0.1;
    
    // ì–‘ì í„°ë„ë§ ì‹œë„
    if (quantumTunneling(e)) {
      e.energy += 0.5;
    }
    
    // SchrÃ¶dinger equation (ê°„ì†Œí™”) - í™•ë¥  ë°€ë„
    const psi = Math.sin(e.phase) * Math.exp(-e.energy * 0.1);
    const probability = psi * psi;
    
    ctx.fillStyle = `rgba(0, 255, 0, ${probability * 0.6})`;
    ctx.beginPath();
    ctx.arc(e.x, e.y, 2, 0, Math.PI * 2);
    ctx.fill();
    
    // ê²½ê³„ í™•ì¸
    if (e.x < 0 || e.x > canvas.width || e.y < 0 || e.y > canvas.height) {
      electrons.splice(idx, 1);
    }
  });
  
  // ì‹ ê²½ì „ë‹¬ë¬¼ì§ˆ ì…ì
  particles.forEach((p, idx) => {
    p.x += p.vx;
    p.y += p.vy;
    p.life -= 0.008;
    
    if (p.life <= 0) {
      particles.splice(idx, 1);
      return;
    }
    
    const colors = {
      dopamine: [255, 170, 0],
      serotonin: [255, 100, 255],
      gaba: [100, 100, 255],
      glutamate: [255, 255, 100]
    };
    const c = colors[p.type] || [255, 170, 0];
    
    ctx.fillStyle = `rgba(${c[0]}, ${c[1]}, ${c[2]}, ${p.life * 0.8})`;
    ctx.beginPath();
    ctx.arc(p.x, p.y, 2.5, 0, Math.PI * 2);
    ctx.fill();
  });
  
  // ë‡Œ ì˜ì—­ ê·¸ë¦¬ê¸°
  Object.entries(brainRegions).forEach(([key, region]) => {
    const isActive = activeRegions.includes(key);
    const isInactive = inactiveRegions && inactiveRegions.includes(key);
    
    // DNA ì´ì¤‘ë‚˜ì„ 
    if (isActive && Math.random() < helixDensity) {
      const helix = generateDNAHelix(region.dna, region.x, region.y, 8);
      helix.forEach(strand => {
        // ë‘ ê°€ë‹¥ ì—°ê²°
        ctx.strokeStyle = '#444';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(strand.x1, strand.y1);
        ctx.lineTo(strand.x2, strand.y2);
        ctx.stroke();
        
        // ì—¼ê¸°
        ctx.fillStyle = strand.color1;
        ctx.beginPath();
        ctx.arc(strand.x1, strand.y1, 2, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = strand.color2;
        ctx.beginPath();
        ctx.arc(strand.x2, strand.y2, 2, 0, Math.PI * 2);
        ctx.fill();
      });
    }
    
    // í™œì„±í™” í›„ê´‘
    if (isActive) {
      const glowSize = region.size + 12 + Math.sin(time * 0.5) * 6;
      const gradient = ctx.createRadialGradient(region.x, region.y, region.size / 2, region.x, region.y, glowSize);
      gradient.addColorStop(0, 'rgba(255, 68, 68, 0.5)');
      gradient.addColorStop(1, 'rgba(255, 68, 68, 0)');
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(region.x, region.y, glowSize, 0, Math.PI * 2);
      ctx.fill();
    }
    
    // ì˜ì—­ ì›
    if (isActive) {
      ctx.fillStyle = '#ff4444';
      ctx.strokeStyle = '#ff6666';
    } else if (isInactive) {
      ctx.fillStyle = '#1a1a1a';
      ctx.strokeStyle = '#333';
    } else {
      ctx.fillStyle = '#444';
      ctx.strokeStyle = '#666';
    }
    
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(region.x, region.y, region.size / 2, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();
    
    // ì´ë¦„
    ctx.fillStyle = isActive ? '#fff' : '#888';
    ctx.font = '10px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(region.name, region.x, region.y + region.size / 2 + 14);
  });
  
  // ì •ë³´ í‘œì‹œ
  ctx.fillStyle = '#4fc3f7';
  ctx.font = 'bold 14px sans-serif';
  ctx.textAlign = 'left';
  ctx.fillText(`${drug.name} | ì‹œê°„: ${time.toFixed(1)}ì´ˆ`, 20, 25);
  
  // ìƒˆ ì…ì/ì „ì ìƒì„±
  if (particles.length < 80 && activeRegions.length > 0 && Math.random() < 0.3) {
    createParticles(activeRegions, drug);
  }
  
  if (electrons.length < 150 && activeRegions.length > 0 && Math.random() < 0.2) {
    activeRegions.forEach(key => {
      const region = brainRegions[key];
      if (region) {
        electrons.push(...createElectronCloud(region, 3));
      }
    });
  }
  
  animationFrame = requestAnimationFrame(render);
}

// ì •ë³´ íŒ¨ë„ ì—…ë°ì´íŠ¸
function updateInfoPanel() {
  const drug = drugData[currentDrug];
  const acidBase = calculateAcidBase();
  const diffusion = parseFloat(document.getElementById('diffusion').value);
  const viscosity = parseFloat(document.getElementById('viscosity').value);
  const tunneling = parseFloat(document.getElementById('tunneling').value);
  
  let html = `
    <div class="info-section">
      <div class="info-title">ğŸ’Š ${drug.name}</div>
      íš¨ê³¼ ê°•ë„: <span class="value-display">${(drug.effectStrength * 100).toFixed(0)}%</span><br>
      í™œì„± ì˜ì—­: <span class="value-display">${(drug.activeRegions || []).length}ê°œ</span>
    </div>
    
    <div class="info-section">
      <div class="info-title">ğŸ§¬ DNA ì´ì¤‘ë‚˜ì„  êµ¬ì¡°</div>
      ê° ë‡Œ ì˜ì—­ì€ ê³ ìœ í•œ ATCG ì—¼ê¸°ì„œì—´ ë³´ìœ <br>
      <div class="equation">
        ë‚˜ì„ ê° Î¸ = i Ã— 0.5 rad<br>
        ì¢Œí‘œ (x,y) = (xâ‚€ Â± rÂ·cos Î¸, yâ‚€ + iÂ·p)
      </div>
      A-T: ìˆ˜ì†Œê²°í•© 2ê°œ (ì•½í•¨)<br>
      C-G: ìˆ˜ì†Œê²°í•© 3ê°œ (ê°•í•¨)
    </div>
    
    <div class="info-section">
      <div class="info-title">ğŸŒŠ Navier-Stokes 2D ë°©ì •ì‹</div>
      ìœ ì²´ì—­í•™ì  ì‹ ê²½ì „ë‹¬ë¬¼ì§ˆ íë¦„<br>
      <div class="equation">
        âˆ‚u/âˆ‚t + (uÂ·âˆ‡)u = -âˆ‡p/Ï + Î½âˆ‡Â²u<br>
        ì ì„±ê³„ìˆ˜ Î½ = <span class="value-display">${viscosity}</span>
      </div>
      ë¹„ì••ì¶•ì„± ê°€ì •: âˆ‡Â·u = 0
    </div>
    
    <div class="info-section">
      <div class="info-title">ğŸ“Š Burgers ë°©ì •ì‹</div>
      ë¹„ì„ í˜• ëŒ€ë¥˜-í™•ì‚° ëª¨ë¸<br>
      <div class="equation">
        âˆ‚u/âˆ‚t + u(âˆ‚u/âˆ‚x) = Î½(âˆ‚Â²u/âˆ‚xÂ²)<br>
        ëŒ€ë¥˜í•­: u(âˆ‚u/âˆ‚x)<br>
        í™•ì‚°í•­: Î½(âˆ‚Â²u/âˆ‚xÂ²)
      </div>
      ì¶©ê²©íŒŒ í˜•ì„± ë° ì „íŒŒ ì‹œë®¬ë ˆì´ì…˜
    </div>
    
    <div class="info-section">
      <div class="info-title">âš¡ ì „ì ë¶„í¬ (ì–‘ìì—­í•™)</div>
      í™•ì‚°ê³„ìˆ˜ D = <span class="value-display">${diffusion}</span><br>
      <div class="equation">
        Ï(r) = |Ïˆ|Â² = exp(-rÂ²/2ÏƒÂ²)<br>
        Ïƒ = âˆš(2Dt) (Gaussian ë¶„í¬)
      </div>
      íŒŒë™í•¨ìˆ˜: Ïˆ = sin(Ï†)Â·exp(-E/kT)
    </div>
    
    <div class="info-section">
      <div class="info-title">ğŸ¯ ì–‘ì í„°ë„ë§</div>
      í„°ë„ë§ í™•ë¥ : <span class="value-display">${(tunneling * 100).toFixed(1)}%</span><br>
      <div class="equation">
        T â‰ˆ exp(-2Îºd)<br>
        Îº = âˆš(2m(V-E)/â„Â²)<br>
        d = ì¥ë²½ ë‘ê»˜
      </div>
      ì „ìê°€ ì‹ ê²½ë§‰ ì „ìœ„ ì¥ë²½ í†µê³¼
    </div>
    
    <div class="info-section">
      <div class="info-title">ğŸ§ª ì‚°-ì—¼ê¸° í‰í˜•</div>
      <div class="equation">
        pH = pKa + log([Aâ»]/[HA])<br>
        í˜„ì¬ pH = <span class="value-display">${acidBase.pH.toFixed(2)}</span><br>
        ì‚°ì„±í˜•: ${(acidBase.acidicForm * 100).toFixed(1)}%<br>
        ì—¼ê¸°í˜•: ${(acidBase.basicForm * 100).toFixed(1)}%<br>
        ì™„ì¶©ëŠ¥: ${acidBase.bufferCapacity.toFixed(3)}
      </div>
      Henderson-Hasselbalch ë°©ì •ì‹
    </div>
    
    <div class="info-section">
      <div class="info-title">ğŸ§¬ ì‹ ê²½ì „ë‹¬ë¬¼ì§ˆ ë†ë„</div>
      <strong>ë„íŒŒë¯¼ (Dopamine)</strong>
      <div class="neurotransmitter-bar">
        <div class="nt-fill" style="width:${drug.dopamine * 100}%; background:linear-gradient(90deg, #ff4444, #ff8888);"></div>
      </div>
      ${(drug.dopamine * 100).toFixed(0)}% - ë³´ìƒ, ë™ê¸°, ìš´ë™<br><br>
      
      <strong>ì„¸ë¡œí† ë‹Œ (Serotonin)</strong>
      <div class="neurotransmitter-bar">
        <div class="nt-fill" style="width:${drug.serotonin * 100}%; background:linear-gradient(90deg, #ff44ff, #ff88ff);"></div>
      </div>
      ${(drug.serotonin * 100).toFixed(0)}% - ê¸°ë¶„, ìˆ˜ë©´, ì‹ìš•<br><br>
      
      <strong>GABA</strong>
      <div class="neurotransmitter-bar">
        <div class="nt-fill" style="width:${drug.gaba * 100}%; background:linear-gradient(90deg, #4444ff, #8888ff);"></div>
      </div>
      ${(drug.gaba * 100).toFixed(0)}% - ì–µì œì„± ì‹ ê²½ì „ë‹¬<br><br>
      
      <strong>ê¸€ë£¨íƒ€ë©”ì´íŠ¸ (Glutamate)</strong>
      <div class="neurotransmitter-bar">
        <div class="nt-fill" style="width:${drug.glutamate * 100}%; background:linear-gradient(90deg, #ffff44, #ffff88);"></div>
      </div>
      ${(drug.glutamate * 100).toFixed(0)}% - í¥ë¶„ì„± ì‹ ê²½ì „ë‹¬<br><br>
      
      <strong>ì•„ì„¸í‹¸ì½œë¦° (Acetylcholine)</strong>
      <div class="neurotransmitter-bar">
        <div class="nt-fill" style="width:${drug.acetylcholine * 100}%; background:linear-gradient(90deg, #44ffff, #88ffff);"></div>
      </div>
      ${(drug.acetylcholine * 100).toFixed(0)}% - í•™ìŠµ, ê¸°ì–µ, ê·¼ìœ¡
    </div>
    
    <div class="info-section">
      <div class="info-title">ğŸŒ¡ï¸ ì—´ì—­í•™ì  íŒŒë¼ë¯¸í„°</div>
      <div class="equation">
        ì˜¨ë„ T = <span class="value-display">${drug.temperature.toFixed(2)} K</span><br>
        ì‚¼íˆ¬ì•• Ï€ = <span class="value-display">${drug.osmolarity.toFixed(2)}</span> Osm<br>
        ë³¼ì¸ ë§Œ ìƒìˆ˜ k = ${BOLTZMANN.toExponential(3)} J/K<br>
        <br>
        ììœ ì—ë„ˆì§€: Î”G = Î”H - TÎ”S<br>
        í‰í˜•ìƒìˆ˜: K = exp(-Î”G/RT)
      </div>
    </div>
    
    <div class="info-section">
      <div class="info-title">âš›ï¸ ì–‘ìí™”í•™</div>
      <div class="equation">
        SchrÃ¶dinger ë°©ì •ì‹:<br>
        iâ„(âˆ‚Ïˆ/âˆ‚t) = Ä¤Ïˆ<br>
        <br>
        í”Œë‘í¬ ìƒìˆ˜ â„ = ${(PLANCK / (2 * Math.PI)).toExponential(3)} JÂ·s<br>
        ì•„ë³´ê°€ë“œë¡œ ìˆ˜ Nâ‚ = ${AVOGADRO.toExponential(3)} molâ»Â¹
      </div>
    </div>
    
    <div class="info-section">
      <div class="info-title">ğŸ“ˆ í™œì„± ì˜ì—­ ëª©ë¡</div>
      ${(drug.activeRegions || []).map(key => {
        const region = brainRegions[key];
        return region ? `ğŸ”´ ${region.name} (${region.dna.substring(0, 8)}...)` : '';
      }).join('<br>')}
      ${drug.inactiveRegions ? '<br><br><strong>ì–µì œ ì˜ì—­:</strong><br>' + drug.inactiveRegions.map(key => {
        const region = brainRegions[key];
        return region ? `âš« ${region.name}` : '';
      }).join('<br>') : ''}
    </div>
  `;
  
  document.getElementById('rightPanel').innerHTML = html;
}

// ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
document.getElementById('applyBtn').onclick = () => {
  currentDrug = document.getElementById('drugSelect').value;
  time = 0;
  particles = [];
  electrons = [];
  initFluidField();
  
  const drug = drugData[currentDrug];
  createParticles(drug.activeRegions || [], drug);
  
  (drug.activeRegions || []).forEach(key => {
    const region = brainRegions[key];
    if (region) {
      electrons.push(...createElectronCloud(region, 10));
    }
  });
  
  updateInfoPanel();
  isPaused = false;
  
  if (animationFrame) cancelAnimationFrame(animationFrame);
  render();
};

document.getElementById('pauseBtn').onclick = () => {
  isPaused = !isPaused;
  document.getElementById('pauseBtn').textContent = isPaused ? 'â–¶ï¸ ì¬ìƒ' : 'â¸ï¸ ì¼ì‹œì •ì§€';
  if (!isPaused) render();
};

document.getElementById('resetBtn').onclick = () => {
  document.getElementById('drugSelect').value = 'none';
  document.getElementById('dosage').value = '100';
  document.getElementById('timeElapsed').value = '30';
  document.getElementById('helixDensity').value = '0.7';
  document.getElementById('viscosity').value = '0.05';
  document.getElementById('diffusion').value = '1.5';
  document.getElementById('tunneling').value = '0.08';
  document.getElementById('pH').value = '7.4';
  currentDrug = 'none';
  time = 0;
  particles = [];
  electrons = [];
  initFluidField();
  updateInfoPanel();
  isPaused = false;
  
  if (animationFrame) cancelAnimationFrame(animationFrame);
  render();
};

document.getElementById('saveBtn').onclick = () => {
  const link = document.createElement('a');
  link.download = `brain_simulation_${currentDrug}_${Date.now()}.png`;
  link.href = canvas.toDataURL();
  link.click();
};

// ì´ˆê¸°í™”
initFluidField();
updateInfoPanel();
render();
</script>
</body>
</html>